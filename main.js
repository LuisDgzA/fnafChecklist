const collectables = [
    {
        id: 1,
        src: 'bob_arcoiris_negro',
        srcColor: 'bob_arcoiris_color',
    },
    {
        id: 2,
        src: 'calamardo_negro',
        srcColor: 'calamardo_color',
    },
    {
        id: 3,
        src: 'don_cangrejo_negro',
        srcColor: 'don_cangrejo_color',
    },
    {
        id: 4,
        src: 'gary_negro',
        srcColor: 'gary_color',
    },
    {
        id: 5,
        src: 'plankton_negro',
        srcColor: 'plankton_color',
    },
    {
        id: 6,
        src: 'patricio_barril_negro',
        srcColor: 'patricio_barril_color',
    },
    {
        id: 7,
        src: 'don_cangrejo_violin_negro',
        srcColor: 'don_cangrejo_violin_color',
    },
    {
        id: 8,
        src: 'policia_negro',
        srcColor: 'policia_color',
    },
    {
        id: 9,
        src: 'arenita_super_negro',
        srcColor: 'arenita_super_color',
    },
    {
        id: 10,
        src: 'patricio_super_negro',
        srcColor: 'patricio_super_color',
    },
    {
        id: 11,
        src: 'sirenoman_negro',
        srcColor: 'sirenoman_color',
    },
    {
        id: 12,
        src: 'chico_perseve_negro',
        srcColor: 'chico_perseve_color',
    },
    {
        id: 13,
        src: 'carrerin_negro',
        srcColor: 'carrerin_color',
    },
    {
        id: 14,
        src: 'cracatoa_negro',
        srcColor: 'cracatoa_color',
    },
    {
        id: 15,
        src: 'patricio_rapero_negro',
        srcColor: 'patricio_rapero_color',
    },
    {
        id: 16,
        src: 'bob_rapero_negro',
        srcColor: 'bob_rapero_color',
    },
    {
        id: 17,
        src: 'arenita_negro',
        srcColor: 'arenita_color',
    },
    {
        id: 18,
        src: 'bob_festejo_negro',
        srcColor: 'bob_festejo_color',
    },
    {
        id: 19,
        src: 'perlita_negro',
        srcColor: 'perlita_color',
    },
    {
        id: 20,
        src: 'arenita_hibernacion_negro',
        srcColor: 'arenita_hibernacion_color',
    },
    {
        id: 21,
        src: 'calamardo_guapo_negro',
        srcColor: 'calamardo_guapo_color',
    },
]

const collectablesTras = [
    {
        id: 101,
        src: 'bob_tras_negro',
        srcColor: 'bob_tras_color',
    },
    {
        id: 102,
        src: 'plankton_tras_negro',
        srcColor: 'plankton_tras_color',
    },
    {
        id: 103,
        src: 'don_cangrejo_tras_negro',
        srcColor: 'don_cangrejo_tras_color',
    },
    {
        id: 104,
        src: 'anchoa_tras_negro',
        srcColor: 'anchoa_tras_color',
    },
    {
        id: 105,
        src: 'perlita_tras_negro',
        srcColor: 'perlita_tras_color',
    },
    {
        id: 106,
        src: 'cala_tras_negro',
        srcColor: 'cala_tras_color',
    },
    {
        id: 107,
        src: 'holandes_tras_negro',
        srcColor: 'holandes_tras_color',
    },
    {
        id: 108,
        src: 'gary_tras_negro',
        srcColor: 'gary_tras_color',
    },
    {
        id: 109,
        src: 'abuela_tras_negro',
        srcColor: 'abuela_tras_color',
    },
    {
        id: 110,
        src: 'patricio_tras_negro',
        srcColor: 'patricio_tras_color',
    },
    
]

const collectablesLLa = [
    {
        id: 201,
        src: 'bob_tras_negro',
        srcColor: 'c_bob',
    },
    {
        id: 202,
        src: 'plankton_tras_negro',
        srcColor: 'c_arenita',
    },
    {
        id: 203,
        src: 'don_cangrejo_tras_negro',
        srcColor: 'c_bob_pat_gary',
    },
    {
        id: 204,
        src: 'anchoa_tras_negro',
        srcColor: 'c_calamardo',
    },
    {
        id: 205,
        src: 'perlita_tras_negro',
        srcColor: 'c_don_cangrejo',
    },
    {
        id: 206,
        src: 'cala_tras_negro',
        srcColor: 'c_imaginacion',
    },
    {
        id: 207,
        src: 'holandes_tras_negro',
        srcColor: 'c_patricio',
    },
    {
        id: 208,
        src: 'gary_tras_negro',
        srcColor: 'c_perlita',
    },
    {
        id: 209,
        src: 'abuela_tras_negro',
        srcColor: 'c_plankton',
    },
    {
        id: 210,
        src: 'patricio_tras_negro',
        srcColor: 'c_todos',
    },
    
]

const collectablesCaps = [
    {
        id: 301,
        src: 'bob_tras_negro',
        srcColor: 'cap_calamardo_color',
    },
    {
        id: 302,
        src: 'plankton_tras_negro',
        srcColor: 'cap_friends',
    },
    {
        id: 303,
        src: 'don_cangrejo_tras_negro',
        srcColor: 'cap_carteles',
    },
    {
        id: 304,
        src: 'anchoa_tras_negro',
        srcColor: 'cap_plankton',
    },
    {
        id: 305,
        src: 'perlita_tras_negro',
        srcColor: 'cap_flotando',
    },
    {
        id: 306,
        src: 'cala_tras_negro',
        srcColor: 'cap_girando',
    },
    {
        id: 307,
        src: 'holandes_tras_negro',
        srcColor: 'cap_rainbow',
    },
    {
        id: 308,
        src: 'gary_tras_negro',
        srcColor: 'cap_friends2',
    },
    {
        id: 309,
        src: 'abuela_tras_negro',
        srcColor: 'cap_abajo',
    },
    {
        id: 310,
        src: 'abuela_tras_negro',
        srcColor: 'cap_bob_main',
    },
    
]

let idsOwned = localStorage.getItem('owned') ? JSON.parse(localStorage.getItem('owned')) : [];

console.log(idsOwned)

const ItemsWrapper = document.querySelector('.collection-1')

collectables.forEach((collectable,index) => {
    let isOwned = idsOwned.includes(collectable.id);
    ItemsWrapper.insertAdjacentHTML('beforeend',
        `<div class="item ${isOwned ? 'owned' : '' }" data-id="${collectable.id}" data-col="1">
            <img class="noise" src="./assets/img/bg.png"/>
            <img class="bateria" src="./assets/img/Vector.webp"/>   
            <img class="bateria_full" src="./assets/img/Group.webp" />
            <div class="recording"></div>      
            <div class="imagen-fondo" style="--bgimg: url('./assets/img/${collectable.srcColor}.webp')"></div>
        </div>`)
})



const ItemsWrapper2 = document.querySelector('.collection-2')

collectablesTras.forEach((collectable,index) => {
    let isOwned = idsOwned.includes(collectable.id);
    ItemsWrapper2.insertAdjacentHTML('beforeend',
        `<div class="item ${isOwned ? 'owned' : '' }" data-id="${collectable.id}" data-col="2">
            <img class="noise" src="./assets/img/bg.png"/>
            <img class="bateria" src="./assets/img/Vector.webp"/>   
            <img class="bateria_full" src="./assets/img/Group.webp" />
            <div class="recording"></div>
            <div class="imagen-fondo" style="--bgimg: url('./assets/img/${collectable.srcColor}.webp')"></div>
            
        </div>`)
})

const ItemsWrapper3 = document.querySelector('.collection-3')

collectablesLLa.forEach((collectable,index) => {
    let isOwned = idsOwned.includes(collectable.id);
    ItemsWrapper3.insertAdjacentHTML('beforeend',
        `<div class="item ${isOwned ? 'owned' : '' }" data-id="${collectable.id}" data-col="3">
            <img class="noise" src="./assets/img/bg.png"/>
            <img class="bateria" src="./assets/img/Vector.webp"/>   
            <img class="bateria_full" src="./assets/img/Group.webp" />
            <div class="recording"></div>
            <div class="imagen-fondo" style="--bgimg: url('./assets/img/${collectable.srcColor}.webp')"></div>
            
        </div>`)
})

const ItemsWrapper4 = document.querySelector('.collection-4')

collectablesCaps.forEach((collectable,index) => {
    let isOwned = idsOwned.includes(collectable.id);
    ItemsWrapper4.insertAdjacentHTML('beforeend',
        `<div class="item ${isOwned ? 'owned' : '' }" data-id="${collectable.id}" data-col="4">
            <img class="noise" src="./assets/img/bg.png"/>
            <img class="bateria" src="./assets/img/Vector.webp"/>   
            <img class="bateria_full" src="./assets/img/Group.webp" />
            <div class="recording"></div>
            <div class="imagen-fondo" style="--bgimg: url('./assets/img/${collectable.srcColor}.webp')"></div>
            
        </div>`)
})


const Items = document.querySelectorAll('.item');

Items.forEach(item => {
    item.addEventListener('click', () => {
        item.classList.toggle('owned')
        // let itemsLocalStorage 

        let id = parseInt(item.getAttribute('data-id'))
        if(idsOwned.includes(id)){
            console.log('si lo incluye')
            idsOwned = idsOwned.filter(theId => theId != id)
        }else{
            idsOwned.push(id)
        }
        

        localStorage.setItem("owned", JSON.stringify(idsOwned));
        let collectionNumber = item.closest('div').getAttribute('data-col')
        console.log('colnumber',collectionNumber)
        RefreshCollected(collectionNumber)
    })
})

const Puzzle = document.getElementById('Puzzle');

for(let i = 1; i < 6; i++){
    for(let j = 1; j < 8; j++){
        let isOwnedP = idsOwned.includes(Number(`10${i}${j}`));
        // console.log('isownedpus',isOwnedP)
        Puzzle.insertAdjacentHTML('beforeend', `
            <div class="item_puzzle ${isOwnedP ? 'owned' : '' }" data-id="10${i}${j}"><img  src="./assets/img/row-${i}-column-${j}.png" alt="ij"  /></div>`)
    }
}

const ItemsPuzzle = document.querySelectorAll('.item_puzzle');

// console.log(ItemsPuzzle)

ItemsPuzzle.forEach(item => {
    item.addEventListener('click', (e) => {
        item.classList.toggle('owned')
        // console.log('puzzle')
        // let itemsLocalStorage 

        let id = parseInt(item.getAttribute('data-id'))
        if(idsOwned.includes(id)){
            console.log('si lo incluye')
            idsOwned = idsOwned.filter(theId => theId != id)
        }else{
            idsOwned.push(id)
        }
        // console.log('id',id)
        // console.log(idsOwned)

        localStorage.setItem("owned", JSON.stringify(idsOwned));
        let collectionNumber = item.closest('div')
        console.log('colnumber',collectionNumber)
        RefreshCollected(collectionNumber)
    })
})

function RefreshCollected(collectionNumber){
    console.log(collectionNumber)
    let Col1 = document.getElementById('col1')

    let col1Owned = document.querySelectorAll('.collection-1 .item.owned')

    Col1.innerHTML = `${col1Owned.length} / ${collectables.length}`
    
    

    let Col2 = document.getElementById('col2')

    let col2Owned = document.querySelectorAll('.collection-2 .item.owned')

    Col2.innerHTML = `${col2Owned.length} / ${collectablesTras.length}`

    let Col3 = document.getElementById('col3')

    let col3Owned = document.querySelectorAll('.collection-3 .item.owned')

    Col3.innerHTML = `${col3Owned.length} / ${collectablesLLa.length}`

    let Col4 = document.getElementById('col4')

    let col4Owned = document.querySelectorAll('.collection-4 .item.owned')

    Col4.innerHTML = `${col4Owned.length} / ${collectablesCaps.length}`

    let Col5 = document.getElementById('col5')

    let col5Owned = document.querySelectorAll('.puzzle .item_puzzle.owned')

    let puzzleItems = document.querySelectorAll('.item_puzzle')

    Col5.innerHTML = `${col5Owned.length} / ${puzzleItems.length}`

    if(collectionNumber == 1 && (col1Owned.length == collectables.length)){
        fireWorks()
    }

    if(collectionNumber == 2 && (col2Owned.length == collectablesTras.length)){
        fireWorks()
    }
    if(collectionNumber == 3 && (col3Owned.length == collectablesLLa.length)){
        fireWorks()
    }
    if(collectionNumber == 4 && (col4Owned.length == collectablesCaps.length)){
        fireWorks()
    }
    if(collectionNumber == 5 && (col5Owned.length == puzzleItems.length)){
        fireWorks()
    }

}


function showTime(){
    let date = new Date();
    let h = date.getHours(); // 0 - 23
    
   
    let session = "AM";
    
    if(h == 0){
        h = 12;
    }
    
    if(h > 12){
        h = h - 12;
        session = "PM";
    }
    
    h = (h < 10) ? "0" + h : h;
    
    
    let time = h + " " + session;
    document.getElementById("clock").innerText = time;
    // document.getElementById("MyClockDisplay").textContent = time;
    
    setTimeout(showTime, 1000);
    
}

function fireWorks(){
    var duration = 7 * 1000;
    var animationEnd = Date.now() + duration;
    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

    function randomInRange(min, max) {
    return Math.random() * (max - min) + min;
    }

    var interval = setInterval(function() {
    var timeLeft = animationEnd - Date.now();

    if (timeLeft <= 0) {
        return clearInterval(interval);
    }

    var particleCount = 50 * (timeLeft / duration);
    // since particles fall down, start a bit higher than random
    confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
    confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
    }, 250);
}

let Imagen = document.getElementById("imagen")

Imagen.addEventListener("click", async () => {
    
    const response = await fetch(`https://screenshot.brosvalley.com/screenshot?ids=1,2,3&col=1`);
    console.log(response)
    if (response.ok) {
        const data = await response.text(); // Recibimos el HTML con la imagen en base64
        
        // Crear un enlace de descarga para la imagen
        const link = document.createElement('a');
        const base64Image = data.match(/data:image\/png;base64,([a-zA-Z0-9+/=]+)/)[0];
        
        link.href = base64Image;
        link.download = 'screenshot.png'; // Nombre del archivo a descargar
        link.click();
    } else {
        console.error('Error al obtener la captura de pantalla');
    }
})

showTime();
RefreshCollected()

